var KernelContextNumber=(function(){var a=function(c,b){this.n=c;this.type=b};a.prototype.valueOf=function(){return this.n};return a})();var Char=function(a){return new KernelContextNumber(a,"Char")};var Float=function(a){return new KernelContextNumber(a,"Float")};var Int32=function(a){return new KernelContextNumber(a,"Int32")};var Int16=function(a){return new KernelContextNumber(a,"Int16")};var Int8=function(a){return new KernelContextNumber(a,"Int8")};var Uint32=function(a){return new KernelContextNumber(a,"Uint32")};var Uint16=function(a){return new KernelContextNumber(a,"Uint16")};var Uint8=function(a){return new KernelContextNumber(a,"Uint8")};var KernelContext=(function(){var d=function(e,g){this.kernelContext=e;this.kernel=g;var f=this;return function(){var k=arguments[0];if(!(k.global instanceof Array)){k.global=[k.global]}if(!(k.local instanceof Array)){k.local=[k.local]}for(var h=1;h<arguments.length;h++){var j=b(arguments[h]);if(j){f.kernel.setKernelArg(h-1,arguments[h].valueOf(),j)}else{f.kernel.setKernelArg(h-1,arguments[h])}}f.kernelContext.queue.enqueueNDRangeKernel(f.kernel,k.global.length,[],k.global,k.local,[])}};var c=function(){if(window.WebCL==undefined){throw"Unfortunately your system does not support WebCL. Make sure that you have both the OpenCL driver and the WebCL browser extension installed."}this.platforms=WebCL.getPlatformIDs();this.context=WebCL.createContextFromType([WebCL.CL_CONTEXT_PLATFORM,this.platforms[0]],WebCL.CL_DEVICE_TYPE_DEFAULT);this.devices=this.context.getContextInfo(WebCL.CL_CONTEXT_DEVICES);this.queue=this.context.createCommandQueue(this.devices[0],0);this.onGPU=[]};var a=function(e){if(e instanceof Float64Array){return e.length*8}if(e instanceof Uint32Array||e instanceof Int32Array||e instanceof Float32Array){return e.length*4}else{if(e instanceof Uint16Array||e instanceof Int16Array){return e.length*2}else{if(e instanceof Uint8Array||e instanceof Int8Array){return e.length}}}};var b=function(f){var e={Char:WebCL.types.CHAR,Float:WebCL.types.FLOAT,Int32:WebCL.types.INT,Int16:WebCL.types.SHORT,Int8:WebCL.types.BYTE,Uint32:WebCL.types.UINT,Uint16:WebCL.types.USHORT,Uint8:WebCL.types.UBYTE};return e[f.type]};c.prototype.compile=function(i,h){var g=this.context.createProgramWithSource(i);try{g.buildProgram([this.devices[0]],"")}catch(j){console.log("Failed to build WebCL program. Error "+g.getProgramBuildInfo(this.devices[0],WebCL.CL_PROGRAM_BUILD_STATUS)+": "+g.getProgramBuildInfo(this.devices[0],WebCL.CL_PROGRAM_BUILD_LOG))}return new d(this,g.createKernel(h))};c.prototype.fromGPU=function(h,e){if(e===undefined){for(var g=0;g<this.onGPU.length;g++){if(this.onGPU[g].handle==h){e=new this.onGPU[g].data.constructor(this.onGPU[g].data.length)}}}var f=a(e);this.queue.enqueueReadBuffer(h,false,0,f,e,[]);this.queue.finish();return e};c.prototype.toGPU=function(g){var f=a(g);var e=this.context.createBuffer(WebCL.CL_MEM_READ_WRITE,f);this.queue.enqueueWriteBuffer(e,false,0,f,g,[]);this.onGPU.push({data:g,handle:e});return e};return c})();var CrowdCL=(function(){var b=[];var a=function(c){if(c.server===undefined){throw"Server is not defined"}if(c.id===undefined){throw"ID is not defined"}this.options=c};a.prototype.commit=function(){var c=this;$.ajax({contentType:"application/json; charset=utf-8",dataType:"json",type:"POST",url:this.options.server+"/commit/"+this.options.id,data:JSON.stringify({results:b}),success:function(d){if(d.best!==false&&c.options.onBest!==undefined){c.options.onBest(d.best)}}})};a.prototype.save=function(c){b.push(c);if(this.options.stage!==undefined&&b.length>=this.options.stage){this.commit();b.length=0}};return a})();var CrowdCLient=(function(){var a,d,f,c;var g=false;var h=function(k,i){if(i.id===undefined){throw"ID is not defined"}if(i.server===undefined){throw"Server is not defined"}if(window.WebCL===undefined){if(i.status===undefined){console.log("WebCL is not available!")}else{document.getElementById(i.status).innerHTML='WebCL is not available! Download it <a href="http://webcl.nokiaresearch.com" target="_blank">here</a>'}return}if(i.onBest===undefined){i.onBest=function(){}}if(i.stage===undefined){i.stage=100}if(i.timeout===undefined){i.timeout=300}f=k;c=i;a=new CrowdCL({id:c.id,server:c.server,stage:c.stage,onBest:c.onBest});document.addEventListener("click",b);document.addEventListener("mousemove",b);document.addEventListener("keypress",b);setInterval(function(){++d},1000);var j=this;window.addEventListener("beforeunload",function(){j.interrupt()});this.resume()};var b=function(){d=0};var e=function(i){if(f.sync!==undefined){f.sync(i,a)}else{a.save(i)}if(c.onResult!==undefined){c.onResult(i)}var j=Math.max(100,c.timeout-Math.pow(1.2,d));if(!g){setTimeout(function(){f.run(e)},j)}};h.prototype.interrupt=function(){if(f.interrupt!==undefined){f.interrupt(arguments)}g=true};h.prototype.interrupted=function(){return g};h.prototype.resume=function(){g=false;setTimeout(function(){f.run(e)},c.timeout)};h.prototype.sleep=function(j){this.interrupt();var i=this;setTimeout(function(){i.resume()},j)};return h})();